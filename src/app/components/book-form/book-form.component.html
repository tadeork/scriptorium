<form class="book-form" (ngSubmit)="onSubmit()">
  <fieldset class="book-form__fieldset">
    <legend class="book-form__legend">{{ editingBook ? 'Editar libro' : 'Agregar nuevo libro' }}</legend>

    <div class="form-group">
      <label for="title" class="form-label">T√≠tulo *</label>
      <div class="input-wrapper">
        <input
          type="text"
          id="title"
          [(ngModel)]="title"
          name="title"
          placeholder="Ej: Cien a√±os de soledad"
          class="form-input"
          autocomplete="off"
        />
        <div *ngIf="showSuggestions && suggestions.length > 0" class="suggestions">
          <div
            *ngFor="let suggestion of suggestions"
            class="suggestion-item"
            (click)="selectSuggestion(suggestion)"
          >
            <div class="suggestion-title">{{ suggestion.title }}</div>
            <div class="suggestion-author" *ngIf="suggestion.author">
              {{ suggestion.author }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="author" class="form-label">Autor *</label>
      <input
        type="text"
        id="author"
        [(ngModel)]="author"
        name="author"
        placeholder="Ej: Gabriel Garc√≠a M√°rquez"
        class="form-input"
      />
    </div>

    <button
      type="button"
      class="search-library-btn"
      [disabled]="isSearchButtonDisabled"
      (click)="searchLibrary()"
    >
      <span *ngIf="!isSearching" class="btn-content">
        üîç Buscar en librer√≠a
      </span>
      <span *ngIf="isSearching" class="btn-content">
        <span class="spinner"></span> Buscando...
      </span>
    </button>

    <div *ngIf="searchError && noResultsMessage" class="search-error-message">
      {{ noResultsMessage }}
    </div>

    <div *ngIf="showResultsModal && suggestions.length > 0" class="results-modal-overlay" (click)="closeResultsModal()">
      <div class="results-modal" (click)="$event.stopPropagation()">
        <div class="results-header">
          <h3 class="results-title">Resultados de b√∫squeda</h3>
          <button class="results-close-btn" (click)="closeResultsModal()">‚úï</button>
        </div>
        <div class="results-list">
          <div
            *ngFor="let suggestion of suggestions"
            class="result-item"
            [class.has-image]="suggestion.coverImageUrl"
            (click)="selectSuggestion(suggestion)"
          >
            <div class="result-image" *ngIf="suggestion.coverImageUrl">
              <img [src]="suggestion.coverImageUrl" [alt]="suggestion.title" />
            </div>
            <div class="result-content">
              <div class="result-title">{{ suggestion.title }}</div>
              <div class="result-author" *ngIf="suggestion.author">
                {{ suggestion.author }}
              </div>
              <div class="result-info" *ngIf="suggestion.pages || suggestion.isbn">
                <span *ngIf="suggestion.pages" class="result-pages">{{ suggestion.pages }} p√°gs</span>
                <span *ngIf="suggestion.isbn" class="result-isbn">ISBN: {{ suggestion.isbn }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="isbn" class="form-label">ISBN</label>
        <input
          type="text"
          id="isbn"
          [(ngModel)]="isbn"
          name="isbn"
          placeholder="Ej: 978-0-123456-78-9"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label for="pages" class="form-label">P√°ginas</label>
        <input
          type="number"
          id="pages"
          [(ngModel)]="pages"
          name="pages"
          placeholder="Ej: 428"
          class="form-input"
          min="0"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="description" class="form-label">Descripci√≥n</label>
      <textarea
        id="description"
        [(ngModel)]="description"
        name="description"
        placeholder="Opcional: Notas o sinopsis"
        class="form-input form-textarea"
        rows="3"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="status" class="form-label">Estado *</label>
      <select id="status" [(ngModel)]="status" name="status" class="form-input">
        <option value="to-read">Por leer</option>
        <option value="reading">Leyendo</option>
        <option value="read">Le√≠do</option>
        <option value="borrowed">Prestado</option>
        <option value="not-interested">No voy a leer</option>
      </select>
    </div>

    <div *ngIf="status === 'read' || status === 'reading'" class="form-group">
      <label for="progress" class="form-label">Progreso (%)</label>
      <input
        type="range"
        id="progress"
        [(ngModel)]="readProgress"
        name="readProgress"
        class="form-range"
        min="0"
        max="100"
      />
      <span class="progress-value">{{ readProgress }}%</span>
    </div>

    <button type="submit" class="submit-btn">{{ editingBook ? 'Guardar cambios' : 'Agregar libro' }}</button>
  </fieldset>
</form>
