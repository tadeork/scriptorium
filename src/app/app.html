<div class="app-container">
  <header class="app-header">
    <div class="header-content">
      <div class="header-title">
        <h1 class="app-title">{{ title() }}</h1>
        <div class="header-nav">
          <button class="nav-btn" [class.active]="currentView() === 'library'" (click)="setView('library')">
            Biblioteca
          </button>
          <button class="nav-btn nav-btn--wishlist" [class.active]="currentView() === 'wishlist'"
            (click)="setView('wishlist')">
            Lista de Deseados
          </button>
          <button class="nav-btn" [class.active]="currentView() === 'collections'" (click)="setView('collections')">
            Categorías
          </button>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" (click)="toggleLibraryAdmin()" title="Administrar biblioteca">
          ⚙️
        </button>

      </div>
    </div>
  </header>

  <!-- showAddBookModal is handled by app-modal-overlay below -->

  @if (showEditModal) {
  <!-- Manual modal for editing books -->
  <app-modal-overlay [isOpen]="showEditModal" (close)="toggleEditModal()" title="Editar libro" [zIndex]="1200">
    <app-book-form [editingBook]="editingBook" (bookUpdated)="onBookUpdated($event); toggleEditModal()"
      [showTitle]="false"></app-book-form>
  </app-modal-overlay>
  }

  @if (showAdminModal) {
  <div class="form-modal-overlay" (click)="toggleLibraryAdmin()">
    <div class="form-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="toggleLibraryAdmin()">✕</button>
      <app-library-admin (close)="toggleLibraryAdmin()" (showWelcome)="onShowWelcome()"></app-library-admin>
    </div>
  </div>
  }

  <!-- Removed duplicate collection modal block -->
  <main class="app-main">
    @if (currentView() === 'library' || currentView() === 'wishlist') {
    <app-book-list [collection]="$any(currentView())" (editBook)="openEditModal($event)"
      (addBookFromSearch)="onAddBookFromSearch($event)"></app-book-list>
    } @else if (currentView() === 'collections') {
    <app-collections-list (createCollection)="onOpenAddCollection()"
      (collectionSelected)="onSelectCollection($event)"></app-collections-list>
    }
  </main>

  @if (showUpdateNotification) {
  <app-update-notification (reload)="reloadPage()"></app-update-notification>
  }

  <app-welcome-modal (closed)="onWelcomeClosed()"></app-welcome-modal>

  <!-- Floating Action Button -->
  <button class="fab" [class.fab--collection]="currentView() === 'collections'" [class.open]="showAddBookModal"
    (click)="currentView() === 'collections' ? onOpenAddCollection() : toggleAddBookModal()">
    <span class="icon">{{ currentView() === 'collections' ? '+' : '+' }}</span>
  </button>
  @if (currentView() !== 'collections' && showAddBookTooltip) {
  <div class="fab-tooltip">Agregar libro</div>
  }

  <!-- Modal Overlays -->
  <app-modal-overlay [isOpen]="showAddBookModal" (close)="toggleAddBookModal()" title="Agregar nuevo libro">
    <app-book-form (bookAdded)="onBookAdded($event); toggleAddBookModal()" [defaultCollection]="$any(currentView())"
      [initialTitle]="initialFormTitle" [showTitle]="false"></app-book-form>
  </app-modal-overlay>

  <app-modal-overlay [isOpen]="showCollectionModal" (close)="toggleCollectionModal()"
    [title]="editingCollection ? 'Editar Categoría' : 'Nueva Categoría'" [zIndex]="2200" size="large">
    <app-collection-form (collectionCreated)="toggleCollectionModal()" (collectionUpdated)="onCollectionUpdated($event)"
      [editingCollectionName]="editingCollection" [showTitle]="false"></app-collection-form>
  </app-modal-overlay>

  @if (selectedCollection) {
  <app-collection-details [collectionName]="selectedCollection" (close)="onCloseCollectionDetails()"
    (edit)="onEditCollection()"></app-collection-details>
  }
</div>